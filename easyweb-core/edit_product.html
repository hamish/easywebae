<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
	<head>
		<title>easywebAE admin: The Book</title>

		{% include "head.html" %}
		{% include "rich_text_editor_head.html" %}

		<script type="text/javascript">
			function validateForm(form) {
				// make sure EVERY field is validated before we return
				var isValid = validateURL(form["product_return_cancel_url"],  "Cancel URL");
				isValid = validateURL(form["product_return_url"], "Return URL") && isValid;
				isValid = validatePrice(form["product_price"]) && isValid;
				isValid = validateName(form["product_name"]) && isValid;
				
				return isValid;
			}
			
			function validateName(input) {
				if (input.value == "") {
					dojo.byId(input.name + "Error").innerHTML = "Please enter a name";
					input.focus();
					return false;
				}
				
				// clear the error message
				dojo.byId(input.name + "Error").innerHTML = "";
				return true;
			}
			
			function validateURL(select, fieldTitle) {
				if (select.value == "") {
					dojo.byId(select.name + "Error").innerHTML = "Please choose a " + fieldTitle;
					select.focus();
					return false;
				}
				
				// clear the error message
				dojo.byId(select.name + "Error").innerHTML = "";
				return true;
			}
			
			function validatePrice(input) {
				// if price contains only digits, we add ".00" to the end of it
				if (input.value.match(/^\d+$/)) {
					input.value += ".00";
				}
				// if it's not valid show error message
				else if (!input.value.match(/^\d+\.+\d{2}$/)) {
					dojo.byId(input.name + "Error").innerHTML =
						"The price you entered is invalid - please enter only digits and a decimal point. For example <strong>40.00</strong>";
					input.focus();
					return false;
				}
				
				// clear the error message
				dojo.byId(input.name + "Error").innerHTML = "";
				return true;
			}
			
			function validateFileUpload(upload) {
				if (upload.value == "") {
					dojo.byId(upload.name + "Error").innerHTML = "Please choose a file to upload";
					upload.focus;
					return false;
				}
				
				// clear the error message
				dojo.byId(upload.name + "Error").innerHTML = "";
				return true;
			}
		</script>
	</head>
	<body>	

		{% include "menu.html" %}
		
		<div class="content">
			<h1>The Book</h1>
			
			<form onsubmit="return validateForm(this)" enctype="multipart/form-data" id="new_product" name="new_product" action="/admin/saveProduct/" method="POST">
			<table cellspacing="0" cellpadding="0">
				<tr>
					<th>Name</th>
					<th>Price</th>
					<th>Successful Purchase Page</th>
					<th>Failed Purchase Page</th>
					<th>File</th>
					<th>&nbsp;</th>
				</tr>
				
				{% for product in products %}
				<tr>
					<td>{{product.name}}</td>
					<td>${{product.price}}</td>
					<td><a href="{{product.return_url}}">{{product.return_url}}</a></td>
					<td><a href="{{product.return_cancel_url}}">{{product.return_cancel_url}}</a></td>
					<td>{{product.file_name}}</td>
					<th>&nbsp;</th>
				</tr>
				{% endfor %}
				
					<tr class="new">
						<td><input class="name" type="text" name="product_name" value="{{product.name}}"/></td>
						<td>$<input class="price" type="text" id="product_price" name="product_price" onchange="validatePrice(this)" value="{{product.price}}" /></td>
						<td><select id="product_return_url" name="product_return_url">
							<option value="">please select</option>
							{% for page in pages %}
							<option value="{{page.url}}" {% ifequal product.return_url page.url %}SELECTED{% endifequal %} >{{page.url}}</option>
							{% endfor %}
							</select></td>
						<td><select id="product_return_cancel_url" name="product_return_cancel_url">
							<option value="">please select</option>
							{% for page in pages %}
							<option value="{{page.url}}" {% ifequal product.return_cancel_url page.url %}SELECTED{% endifequal %} >{{page.url}}</option>
							{% endfor %}
							</select></td>
						<td>{{product.file_name}}<br /><input type="file" id="product_file_upload"name="product_file_upload" onchange="SplitFile();"/></td>
						<td class="action"><button type="submit"
							onmouseover="dojo.addClass(this.parentNode, 'active')"
							onmouseout="dojo.removeClass(this.parentNode, 'active')">save</button></td>
					</tr>
			</table>
			Subject: <input  type="text" name="sucess_email_subject" {% if product.sucess_email_subject %}value="{{product.sucess_email_subject}}"{% endif %}/><br />
			Body: <textarea id="rich_text" name="sucess_email_body" rows="20" cols="40">{% if product.sucess_email_body %}{{product.sucess_email_body|escape}}{% endif %}</textarea>

				<input type="hidden" id="key"  name="key" value="{{product.key}}" /> 
				
				<input type="hidden" id="product_file_name"  name="product_file_name" value="" /> 
				<input type="hidden" id="product_file_ext"  name="product_file_ext" value="" /> 
			</form>
				
			<ul class="error">
				<li id="product_nameError"></li>
				<li id="product_priceError"></li>
				<li id="product_return_urlError"></li>
				<li id="product_return_cancel_urlError"></li>
				<li id="product_file_uploadError"></li>
			</ul>
		</div>
	</body>
</html>