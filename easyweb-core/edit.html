<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
	<head>
		
		<title>{% if page.key %}Edit{% else %}New{% endif %} Page</title>
		

		{% include "head.html" %}
		{% include "rich_text_editor_head.html" %}

        <script type="text/javascript" src="/static/admin/js/form.js"></script>

		<script type="text/javascript">
            function setSitemapComment() {
                var yesText = "A link to this page will be included on <a href='/Sitemap.xml'>your sitemap</a>.";
                var noText = "This page will <b>not</b> be included on <a href='/Sitemap.xml'>your sitemap</a>.";
                var sitemapSelect = dojo.byId("include_in_sitemap");
                var commentCell = dojo.query("[class^=note]", sitemapSelect.parentNode.parentNode)[0];

                if (sitemapSelect.value == "true") {
                    commentCell.innerHTML = yesText;
                } else {
                    commentCell.innerHTML = noText;
                }
            }

            dojo.addOnLoad(function () {
                setSitemapComment();
            });

            function checkLeadingSlash(field) {
                // add a leading / if not present
                if (field.value != "" && field.value.indexOf("/") != 0) {
                    field.value = "/" + field.value;
                }
            }
        </script>
		
	</head>
	<body>

		{% include "menu.html" %}
		
		<div class="content">
			<h1>{% if page.key %}Edit{% else %}New{% endif %} Page</h1>
			
			<form id="new_page" action="/admin/save/" method="POST" name="page_content" onsubmit="return validateAll()">
				<input type="hidden" name="key"  value="{{page.key}}" />
                
                <table cellpadding="0" cellspacing="0" class="hasHTMLeditor">
                    <tr class="highlightable">
						<th><span class="required">*</span>URL:</th>
                        <td><input type="text" id="url" name="url" class="url validate" onchange="checkLeadingSlash(this)" value="{{page.url}}" /></td>
                        <td name="comment" class="placeholder">&nbsp;</td>
                        <td name="comment" class="note hidden">URLs cannot contain spaces and must start with &quot;/&quot; - eg <i>/my-page.htm</i></td>
                        <td name="comment" class="error hidden">Please enter a URL containing only letters, numbers, hyphen, underscore, dot and forward slash with <b>no spaces</b></td>
                    </tr>
                    <tr class="highlightable">
                        <th><span class="required">*</span>Title:</th>
                        <td><input type="text" id="title" name="title" class="title validate" value="{{page.title}}" /></td>
                        <td name="comment" class="placeholder">&nbsp;</td>
                        <td name="comment" class="note hidden">This will be displayed at the top of the browser window</td>
                        <td name="comment" class="error hidden">Please enter a title</td>
                    </tr>
                    <tr class="highlightable">
                        <th class="nowrap">Promote this page:</th>
                        <td><select id="include_in_sitemap" name="include_in_sitemap" onchange="setSitemapComment()">
                            <option value="true">Yes</option>
                            <option value="false"{% if not page.include_in_sitemap and page.key %} selected="selected"{% endif %}>No</option></select></td>
                        <td name="comment" class="placeholder">&nbsp;</td>
                        <td name="comment" class="note hidden"></td>
                    </tr>
                </table>

                <p class="HTMLeditor"><textarea id="rich_text" name="html" rows="20" cols="40">{{page.html|escape}}</textarea></p>

                <table cellpadding="0" cellspacing="0" class="hasHTMLeditor">
                    <tr class="new">
                        <td name="submit" class="action"
                            onclick="submitForm(dojo.byId('new_page'))"
							onmouseover="dojo.addClass(this, 'active')"
							onmouseout="dojo.removeClass(this, 'active')">save</td>
                        <td name="submit" class="cancel hidden"
                            onclick="submitForm(dojo.byId('new_page'))">Please complete required fields to continue</td>
                        <td class="action cancel" style="width:20px"
                            title="Cancel - your changes will not be saved"
                            onclick="document.location='/admin/pages.html'"
							onmouseover="dojo.addClass(this, 'activecancel')"
							onmouseout="dojo.removeClass(this, 'activecancel')">X</td>
					</tr>
			    </table>
			

			</form>
		</div>
	</body>
</head>