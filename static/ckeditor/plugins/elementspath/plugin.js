/*
Copyright (c) 2003-2009, CKSource - Frederico Knabben. All rights reserved.
For licensing, see LICENSE.html or http://ckeditor.com/license
*/

(function(){var a={toolbarFocus:{exec:function(b){var c=b._.elementsPath.idBase,d=CKEDITOR.document.getById(c+'0');if(d)d.focus();}}};CKEDITOR.plugins.add('elementspath',{requires:['selection'],init:function(b){var c='cke_path_'+b.name,d,e=function(){if(!d)d=CKEDITOR.document.getById(c);return d;},f='cke_elementspath_'+CKEDITOR.tools.getNextNumber()+'_';b._.elementsPath={idBase:f};b.on('themeSpace',function(g){if(g.data.space=='bottom')g.data.html+='<div id="'+c+'" class="cke_path"><br></div>';});b.on('selectionChange',function(g){var h=CKEDITOR.env,i=g.data.selection,j=i.getStartElement(),k=[],l=this._.elementsPath.list=[];while(j){var m=l.push(j)-1,n;if(j.getAttribute('_cke_real_element_type'))n=j.getAttribute('_cke_real_element_type');else n=j.getName();var o='';if(h.opera||h.gecko&&h.mac)o+=' onkeypress="return false;"';if(h.gecko)o+=' onblur="this.style.cssText = this.style.cssText;"';k.unshift('<a id="',f,m,'" href="javascript:void(\'',n,'\')" tabindex="-1" title="',b.lang.elementsPath.eleTitle.replace(/%1/,n),'" onkeydown="return CKEDITOR._.elementsPath.keydown(\'',this.name,"',",m,', event);"'+o," onclick=\"return CKEDITOR._.elementsPath.click('",this.name,"',",m,');">',n,'</a>');if(n=='body')break;j=j.getParent();}e().setHtml(k.join(''));});b.on('contentDomUnload',function(){e().setHtml('<br>');});b.addCommand('elementsPathFocus',a.toolbarFocus);}});})();CKEDITOR._.elementsPath={click:function(a,b){var c=CKEDITOR.instances[a];c.focus();var d=c._.elementsPath.list[b];c.getSelection().selectElement(d);return false;},keydown:function(a,b,c){var d=CKEDITOR.ui.button._.instances[b],e=CKEDITOR.instances[a],f=e._.elementsPath.idBase,g;c=new CKEDITOR.dom.event(c);switch(c.getKeystroke()){case 37:case 9:g=CKEDITOR.document.getById(f+(b+1));if(!g)g=CKEDITOR.document.getById(f+'0');g.focus();return false;case 39:case CKEDITOR.SHIFT+9:g=CKEDITOR.document.getById(f+(b-1));if(!g)g=CKEDITOR.document.getById(f+(e._.elementsPath.list.length-1));g.focus();return false;case 27:e.focus();return false;case 13:case 32:this.click(a,b);return false;}return true;}};
