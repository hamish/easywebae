/*
Copyright (c) 2003-2009, CKSource - Frederico Knabben. All rights reserved.
For licensing, see LICENSE.html or http://ckeditor.com/license
*/

CKEDITOR.plugins.add('button',{beforeInit:function(a){a.ui.addHandler(CKEDITOR.UI_BUTTON,CKEDITOR.ui.button.handler);}});CKEDITOR.UI_BUTTON=1;CKEDITOR.ui.button=function(a){this.label=a.label;this.title=a.title||a.label;this.command=a.command;this.className=a.className||a.command&&'cke_button_'+a.command||'';this.icon=a.icon;this.iconOffset=a.iconOffset;this.click=a.click||(function(b){b.execCommand(a.command);});this._={};};CKEDITOR.ui.button.handler={create:function(a){return new CKEDITOR.ui.button(a);}};CKEDITOR.ui.button.prototype={render:function(a,b){var c=CKEDITOR.env,d=this._.id='cke_'+CKEDITOR.tools.getNextNumber(),e={id:d,button:this,editor:a,focus:function(){var j=CKEDITOR.document.getById(d);j.focus();},execute:function(){this.button.click(a);}},f=CKEDITOR.ui.button._.instances.push(e)-1,g='',h=this.command;if(h){h=a.getCommand(h);if(h){h.on('state',function(){this.setState(h.state);},this);g+=' cke_'+(h.state==CKEDITOR.TRISTATE_ON?'on':h.state==CKEDITOR.TRISTATE_DISABLED?'disabled':'off');}}if(this.className)g+=' '+this.className;b.push('<span class="cke_button">','<a id="',d,'" class="',g,'" href="javascript:void(\'',(this.title||'').replace("'",''),'\')" title="',this.title,'" tabindex="-1" hidefocus="true"');if(c.opera||c.gecko&&c.mac)b.push(' onkeypress="return false;"');if(c.gecko)b.push(' onblur="this.style.cssText = this.style.cssText;"');b.push(' onkeydown="return CKEDITOR.ui.button._.keydown(',f,', event);" onfocus="return CKEDITOR.ui.button._.focus(',f,', event);" onclick="return CKEDITOR.ui.button._.click(',f,', event);"><span class="cke_icon"');if(this.icon){var i=(this.iconOffset||0)*(-16);b.push(' style="background-image:url(',CKEDITOR.getUrl(this.icon),');background-position:0 '+i+'px;"');}b.push('></span><span class="cke_label">',this.label,'</span></a>','</span>');return e;},setState:function(a){if(this._.state==a)return;CKEDITOR.document.getById(this._.id).setState(a);this._.state=a;}};CKEDITOR.ui.button._={instances:[],click:function(a){CKEDITOR.ui.button._.instances[a].execute();return false;},keydown:function(a,b){var c=CKEDITOR.ui.button._.instances[a];if(c.onkey){b=new CKEDITOR.dom.event(b);return c.onkey(c,b.getKeystroke())!==false;}},focus:function(a,b){var c=CKEDITOR.ui.button._.instances[a];if(c.onfocus)return c.onfocus(c,new CKEDITOR.dom.event(b))!==false;}};CKEDITOR.ui.prototype.addButton=function(a,b){this.add(a,CKEDITOR.UI_BUTTON,b);};
