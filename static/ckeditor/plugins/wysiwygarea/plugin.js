/*
Copyright (c) 2003-2009, CKSource - Frederico Knabben. All rights reserved.
For licensing, see LICENSE.html or http://ckeditor.com/license
*/

(function(){function a(c){var f=this;if(f.mode=='wysiwyg'){var d=f.document.$,e=c.data;if(f.dataProcessor)e=f.dataProcessor.toHtml(e);if(CKEDITOR.env.ie)d.selection.createRange().pasteHTML(e);else d.execCommand('inserthtml',false,e);}};function b(c){if(this.mode=='wysiwyg'){var d=c.data,e=d.getName(),f=CKEDITOR.dtd.$block[e],g=this.getSelection(),h=g.getRanges(),i,j,k,l;for(var m=h.length-1;m>=0;m--){i=h[m];i.deleteContents();j=!m&&d||d.clone(true);var n;if(this.config.enterMode!=CKEDITOR.ENTER_BR&&f){var o=new CKEDITOR.dom.elementPath(i.startContainer),p=0,q;while((q=o.elements[p++])&&(q!=o.blockLimit)){var r=q.getName(),s=CKEDITOR.dtd[r];if(s&&!s[e])n=q;}}i.insertNode(j);if(n)j.breakParent(n);if(!k)k=j;}i.moveToPosition(k,CKEDITOR.POSITION_AFTER_END);var t=k.getNextSourceNode(true);if(t&&t.type==CKEDITOR.NODE_ELEMENT)i.moveToElementEditStart(t);g.selectRanges([i]);}};CKEDITOR.plugins.add('wysiwygarea',{requires:['editingblock'],init:function(c){c.on('editingBlockReady',function(){var d,e,f,g,h,i=CKEDITOR.env.ie&&document.domain!=window.location.hostname,j=function(){if(e)e.remove();e=new CKEDITOR.dom.element('iframe').setAttributes({frameBorder:0,tabIndex:-1,allowTransparency:true}).setStyles({width:'100%',height:'100%'});if(CKEDITOR.env.ie)if(i)e.setAttribute('src','javascript:void( (function(){document.open();document.domain="'+document.domain+'";'+'document.write( window.parent._cke_htmlToLoad_'+c.name+' );'+'document.close();'+'window.parent._cke_htmlToLoad_'+c.name+' = null;'+'})() )');else e.setAttribute('src','javascript:void(0)');d.append(e);if(CKEDITOR.env.gecko){d.setAttributes({role:'region',title:'CKEditor '+c.name+'. Type in text.'});e.setAttributes({role:'region',title:' '});}else if(CKEDITOR.env.ie){var m=CKEDITOR.document.createElement('label');m.setStyles({position:'absolute',top:'-1000000px',left:'-1000000px'});m.append(CKEDITOR.document.createText('CKEditor '+c.name));m.insertBefore(e);}},k='<script id="cke_actscrpt" type="text/javascript">window.onload = function(){var s = document.getElementById( "cke_actscrpt" );s.parentNode.removeChild( s );window.parent.CKEDITOR._.contentDomReady'+c.name+'( window );'+'}'+'</script>',l=function(m){delete CKEDITOR._['contentDomReady'+c.name];var n=m.document,o=n.body;o.spellcheck=!c.config.disableNativeSpellChecker;if(CKEDITOR.env.ie){o.hideFocus=true;o.disabled=true;o.contentEditable=true;o.removeAttribute('disabled');}else n.designMode='on';try{n.execCommand('enableObjectResizing',false,!c.config.disableObjectResizing);
}catch(r){}try{n.execCommand('enableInlineTableEditing',false,!c.config.disableNativeTableHandles);}catch(s){}m=c.window=new CKEDITOR.dom.window(m);n=c.document=new CKEDITOR.dom.document(n);var p=CKEDITOR.env.ie||CKEDITOR.env.safari?m:n;p.on('blur',function(){c.focusManager.blur();});p.on('focus',function(){c.focusManager.focus();});var q=c.keystrokeHandler;if(q)q.attach(n);if(c.contextMenu)c.contextMenu.addTarget(n);setTimeout(function(){c.fire('contentDom');if(h){c.mode='wysiwyg';c.fire('mode');h=false;}f=false;if(g){c.focus();g=false;}},0);};c.addMode('wysiwyg',{load:function(m,n,o){d=m;if(!i||!CKEDITOR.env.gecko)j();c.mayBeDirty=true;h=true;if(o)this.loadSnapshotData(n);else this.loadData(n);},loadData:function(m){f=true;if(c.dataProcessor)m=c.dataProcessor.toHtml(m,c.config.enterMode!=CKEDITOR.ENTER_BR);m=c.config.docType+'<html dir="'+c.config.contentsLangDirection+'">'+'<head>'+'<link href="'+c.config.contentsCss+'" type="text/css" rel="stylesheet" _fcktemp="true"/>'+'<style type="text/css" _fcktemp="true">'+c._.styles.join('\n')+'</style>'+'</head>'+'<body>'+m+'</body>'+'</html>'+k;if(i)window['_cke_htmlToLoad_'+c.name]=m;CKEDITOR._['contentDomReady'+c.name]=l;if(i||CKEDITOR.env.gecko)j();if(!i){var n=e.$.contentWindow.document;n.open();n.write(m);n.close();}},getData:function(){var m=e.$.contentWindow.document.body.innerHTML;if(c.dataProcessor)m=c.dataProcessor.toDataFormat(m,c.config.enterMode!=CKEDITOR.ENTER_BR);return m;},getSnapshotData:function(){return e.$.contentWindow.document.body.innerHTML;},loadSnapshotData:function(m){e.$.contentWindow.document.body.innerHTML=m;},unload:function(m){c.window=c.document=e=d=g=null;c.fire('contentDomUnload');},focus:function(){if(f)g=true;else if(c.window){c.window.focus();c.selectionChange();}}});c.on('insertHtml',a,null,null,20);c.on('insertElement',b,null,null,20);});}});})();CKEDITOR.config.disableObjectResizing=false;CKEDITOR.config.disableNativeTableHandles=true;CKEDITOR.config.disableNativeSpellChecker=true;
