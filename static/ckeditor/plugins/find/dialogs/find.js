/*
Copyright (c) 2003-2009, CKSource - Frederico Knabben. All rights reserved.
For licensing, see LICENSE.html or http://ckeditor.com/license
*/

(function(){var a={address:1,blockquote:1,dl:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,p:1,pre:1,li:1,dt:1,de:1,div:1,td:1,th:1},b=function(h){if(h.data.to&&h.data.to.type==CKEDITOR.NODE_TEXT&&h.data.to.$.length>0)this.stop();CKEDITOR.dom.domWalker.blockBoundary({br:1}).call(this,h);},c=function(){var i=this;var h={textNode:i.textNode,offset:i.offset,character:i.textNode?i.textNode.getText().charAt(i.offset):null,hitMatchBoundary:i._.matchBoundary};return h;},d=['find','replace'],e=[['txtFindFind','txtFindReplace'],['txtFindCaseChk','txtReplaceCaseChk'],['txtFindWordChk','txtReplaceWordChk'],['txtFindCyclic','txtReplaceCyclic']];function f(h){var i,j,k,l;i=h==='find'?1:0;j=1-i;var m,n=e.length;for(m=0;m<n;m++){var k=this.getContentElement(d[i],e[m][i]),l=this.getContentElement(d[j],e[m][j]);l.setValue(k.getValue());}};var g=function(h,i){var j=new CKEDITOR.style(h.config.find_highlight),k=function(v,w){var y=this;var x=typeof v.textNode!=='undefined';y.textNode=x?v.textNode:v;y.offset=x?v.offset:w;y._={walker:new CKEDITOR.dom.domWalker(y.textNode),matchBoundary:false};};k.prototype={next:function(){var w=this;if(w.textNode==null)return c.call(w);w._.matchBoundary=false;if(w.textNode.type==CKEDITOR.NODE_TEXT&&w.offset<w.textNode.getLength()-1){w.offset++;return c.call(w);}var v=null;while(!v||v.node&&v.node.type!=CKEDITOR.NODE_TEXT){v=w._.walker.forward(b);if(!v.node||v.node.type!==CKEDITOR.NODE_TEXT&&v.node.getName() in a)w._.matchBoundary=true;}w.textNode=v.node;w.offset=0;return c.call(w);},back:function(){var w=this;w._.matchBoundary=false;if(w.textNode.type==CKEDITOR.NODE_TEXT&&w.offset>0){w.offset--;return c.call(w);}var v=null;while(!v||v.node&&v.node.type!=CKEDITOR.NODE_TEXT){v=w._.walker.reverse(b);if(!v.node||v.node.type!==CKEDITOR.NODE_TEXT&&v.node.getName() in a)w._.matchBoundary=true;}w.textNode=v.node;w.offset=v.node.length-1;return c.call(w);}};var l=function(v,w){this._={walker:v,cursors:[],rangeLength:w,highlightRange:null,isMatched:false};};l.prototype={toDomRange:function(){var v=this._.cursors;if(v.length<1)return null;var w=v[0],x=v[v.length-1],y=new CKEDITOR.dom.range(h.document);y.setStart(w.textNode,w.offset);y.setEnd(x.textNode,x.offset+1);return y;},updateFromDomRange:function(v){var C=this;var w=v.startContainer,x=v.startOffset,y=v.endContainer,z=v.endOffset,A=v.getBoundaryNodes();if(w.type!=CKEDITOR.NODE_TEXT){w=A.startNode;while(w.type!=CKEDITOR.NODE_TEXT)w=w.getFirst();x=0;}if(y.type!=CKEDITOR.NODE_TEXT){y=A.endNode;while(y.type!=CKEDITOR.NODE_TEXT)y=y.getLast();
z=y.getLength();}if(y.getLength()<1){while((y=y.getPreviousSourceNode())&&(!(y.type==CKEDITOR.NODE_TEXT&&y.getLength()>0))){}z=y.getLength();}var B=new k(w,x);C._.cursors=[B];if(!(B.textNode.equals(y)&&B.offset==z-1))do{B=new k(B);B.next();C._.cursors.push(B);}while(!(B.textNode.equals(y)&&B.offset==z-1))C._.rangeLength=C._.cursors.length;},setMatched:function(){this._.isMatched=true;this.highlight();},clearMatched:function(){this._.isMatched=false;this.removeHighlight();},isMatched:function(){return this._.isMatched;},highlight:function(){var x=this;if(x._.cursors.length<1)return;if(x._.highlightRange)x.removeHighlight();var v=x.toDomRange();j.applyToRange(v);x._.highlightRange=v;var w=v.startContainer;if(w.type!=CKEDITOR.NODE_ELEMENT)w=w.getParent();w.scrollIntoView();x.updateFromDomRange(v);},removeHighlight:function(){var v=this;if(v._.highlightRange==null)return;j.removeFromRange(v._.highlightRange);v.updateFromDomRange(v._.highlightRange);v._.highlightRange=null;},moveBack:function(){var x=this;var v=x._.walker.back(),w=x._.cursors;if(v.hitMatchBoundary)x._.cursors=w=[];w.unshift(v);if(w.length>x._.rangeLength)w.pop();return v;},moveNext:function(){var x=this;var v=x._.walker.next(),w=x._.cursors;if(v.hitMatchBoundary)x._.cursors=w=[];w.push(v);if(w.length>x._.rangeLength)w.shift();return v;},getEndCharacter:function(){var v=this._.cursors;if(v.length<1)return null;return v[v.length-1].character;},getNextRange:function(v){var w=this._.cursors;if(w.length<1)return null;var x=new k(w[w.length-1]);return new l(x,v);},getCursors:function(){return this._.cursors;}};var m=0,n=1,o=2,p=function(v,w){var x=[-1];if(w)v=v.toLowerCase();for(var y=0;y<v.length;y++){x.push(x[y]+1);while(x[y+1]>0&&v.charAt(y)!=v.charAt(x[y+1]-1))x[y+1]=x[x[y+1]-1]+1;}this._={overlap:x,state:0,ignoreCase:!!w,pattern:v};};p.prototype={feedCharacter:function(v){var w=this;if(w._.ignoreCase)v=v.toLowerCase();for(;;)if(v==w._.pattern.charAt(w._.state)){w._.state++;if(w._.state==w._.pattern.length){w._.state=0;return o;}return n;}else if(w._.state==0)return m;else w._.state=w._.overlap[w._.state];return null;},reset:function(){this._.state=0;}};var q=/[.,"'?!;: \u0085\u00a0\u1680\u280e\u2028\u2029\u202f\u205f\u3000]/,r=function(v){if(!v)return true;var w=v.charCodeAt(0);return w>=9&&w<=13||w>=8192&&w<=8202||q.test(v);},s={startCursor:null,range:null,find:function(v,w,x,y){var H=this;if(!H.range)H.range=new l(new k(H.startCursor),v.length);else{H.range.removeHighlight();H.range=H.range.getNextRange(v.length);
}var z=new p(v,!w),A=m,B='%';while(B!=null){H.range.moveNext();while(B=H.range.getEndCharacter()){A=z.feedCharacter(B);if(A==o)break;if(H.range.moveNext().hitMatchBoundary)z.reset();}if(A==o){if(x){var C=H.range.getCursors(),D=C[C.length-1],E=C[0],F=new k(E),G=new k(D);if(!(r(F.back().character)&&r(G.next().character)))continue;}H.range.setMatched();return true;}}H.range.clearMatched();if(y){H.startCursor=t();H.range=null;}return false;},replaceCounter:0,replace:function(v,w,x,y,z,A,B){var G=this;var C=false;if(G.range&&G.range.isMatched()){var D=G.range.toDomRange(),E=h.document.createText(x);D.deleteContents();D.insertNode(E);G.range.updateFromDomRange(D);G.replaceCounter++;C=true;}var F=G.find(w,y,z,A);if(F&&B)G.replace.apply(G,Array.prototype.slice.call(arguments));return B?G.replaceCounter:C||F;}};function t(){return{textNode:h.document.getBody(),offset:0};};function u(){if(CKEDITOR.env.ie)this.restoreSelection();var v=h.getSelection();if(v){var w=v.getRanges()[v.getRanges().length-1];return{textNode:w.getBoundaryNodes().endNode,offset:w.endContainer.type===CKEDITOR.NODE_ELEMENT?0:w.endOffset};}else return t();};return{title:h.lang.findAndReplace.title,resizable:CKEDITOR.DIALOG_RESIZE_NONE,minWidth:400,minHeight:255,buttons:[CKEDITOR.dialog.cancelButton],contents:[{id:'find',label:h.lang.findAndReplace.find,title:h.lang.findAndReplace.find,accessKey:'',elements:[{type:'hbox',widths:['230px','90px'],children:[{type:'text',id:'txtFindFind',label:h.lang.findAndReplace.findWhat,isChanged:false,labelLayout:'horizontal',accessKey:'F'},{type:'button',align:'left',style:'width:100%',label:h.lang.findAndReplace.find,onClick:function(){var v=this.getDialog();if(!s.find(v.getValueOf('find','txtFindFind'),v.getValueOf('find','txtFindCaseChk'),v.getValueOf('find','txtFindWordChk'),v.getValueOf('find','txtFindCyclic')))alert(h.lang.findAndReplace.notFoundMsg);}}]},{type:'vbox',padding:0,children:[{type:'checkbox',id:'txtFindCaseChk',isChanged:false,style:'margin-top:28px',label:h.lang.findAndReplace.matchCase},{type:'checkbox',id:'txtFindWordChk',isChanged:false,label:h.lang.findAndReplace.matchWord},{type:'checkbox',id:'txtFindCyclic',isChanged:false,'default':true,label:h.lang.findAndReplace.matchCyclic}]}]},{id:'replace',label:h.lang.findAndReplace.replace,accessKey:'M',elements:[{type:'hbox',widths:['230px','90px'],children:[{type:'text',id:'txtFindReplace',label:h.lang.findAndReplace.findWhat,isChanged:false,labelLayout:'horizontal',accessKey:'F'},{type:'button',align:'left',style:'width:100%',label:h.lang.findAndReplace.replace,onClick:function(){var v=this.getDialog();
if(!s.replace(v,v.getValueOf('replace','txtFindReplace'),v.getValueOf('replace','txtReplace'),v.getValueOf('replace','txtReplaceCaseChk'),v.getValueOf('replace','txtReplaceWordChk'),v.getValueOf('replace','txtReplaceCyclic')))alert(h.lang.findAndReplace.notFoundMsg);}}]},{type:'hbox',widths:['230px','90px'],children:[{type:'text',id:'txtReplace',label:h.lang.findAndReplace.replaceWith,isChanged:false,labelLayout:'horizontal',accessKey:'R'},{type:'button',align:'left',style:'width:100%',label:h.lang.findAndReplace.replaceAll,isChanged:false,onClick:function(){var v=this.getDialog(),w;s.replaceCounter=0;if(w=s.replace(v,v.getValueOf('replace','txtFindReplace'),v.getValueOf('replace','txtReplace'),v.getValueOf('replace','txtReplaceCaseChk'),v.getValueOf('replace','txtReplaceWordChk'),v.getValueOf('replace','txtReplaceCyclic'),true))alert(h.lang.findAndReplace.replaceSuccessMsg.replace(/%1/,w));else alert(h.lang.findAndReplace.notFoundMsg);}}]},{type:'vbox',padding:0,children:[{type:'checkbox',id:'txtReplaceCaseChk',isChanged:false,label:h.lang.findAndReplace.matchCase},{type:'checkbox',id:'txtReplaceWordChk',isChanged:false,label:h.lang.findAndReplace.matchWord},{type:'checkbox',id:'txtReplaceCyclic',isChanged:false,'default':true,label:h.lang.findAndReplace.matchCyclic}]}]}],onLoad:function(){var v=this,w,x,y=false;this.on('hide',function(){y=false;});this.on('show',function(){y=true;});this.selectPage=CKEDITOR.tools.override(this.selectPage,function(z){return function(A){z.call(v,A);var B=v._.tabs[A],C,D,E;D=A==='find'?'txtFindFind':'txtFindReplace';E=A==='find'?'txtFindWordChk':'txtReplaceWordChk';w=v.getContentElement(A,D);x=v.getContentElement(A,E);if(!B.initialized){C=CKEDITOR.document.getById(w._.inputId);B.initialized=true;}if(y)f.call(this,A);};});},onShow:function(){s.startCursor=u.call(this);if(i=='replace')this.getContentElement('replace','txtFindReplace').focus();else this.getContentElement('find','txtFindFind').focus();},onHide:function(){if(s.range&&s.range.isMatched()){s.range.removeHighlight();h.getSelection().selectRanges([s.range.toDomRange()]);}delete s.range;}};};CKEDITOR.dialog.add('find',function(h){return g(h,'find');});CKEDITOR.dialog.add('replace',function(h){return g(h,'replace');});})();
