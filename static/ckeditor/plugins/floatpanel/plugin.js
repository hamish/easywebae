/*
Copyright (c) 2003-2009, CKSource - Frederico Knabben. All rights reserved.
For licensing, see LICENSE.html or http://ckeditor.com/license
*/

CKEDITOR.plugins.add('floatpanel',{requires:['panel']});(function(){var a={};function b(c,d,e,f,g){var h=d.getUniqueId()+'-'+e.getUniqueId()+'-'+c.skinName+(f.css&&'-'+f.css||'')+(g&&'-'+g||''),i=a[h];if(!i){i=a[h]=new CKEDITOR.ui.panel(d,f);i.element=e.append(CKEDITOR.dom.element.createFromHtml(i.renderHtml(c),d));i.element.setStyles({display:'none',position:'absolute'});}return i;};CKEDITOR.ui.floatPanel=CKEDITOR.tools.createClass({$:function(c,d,e,f){e.forceIFrame=true;var g=d.getDocument(),h=b(c,g,d,e,f||0),i=h.element,j=i.getFirst().getFirst();this.element=i;this._={panel:h,parentElement:d,definition:e,document:g,iframe:j,children:[]};},proto:{addBlock:function(c,d){return this._.panel.addBlock(c,d);},addListBlock:function(c,d){return this._.panel.addListBlock(c,d);},getBlock:function(c){return this._.panel.getBlock(c);},showBlock:function(c,d,e,f,g){var h=this._.panel,i=h.showBlock(c),j=this.element,k=this._.iframe,l=d.getDocumentPosition(j.getDocument()),m=l.x+(f||0),n=l.y+(g||0);if(e==2||e==3)m+=d.$.offsetWidth-1;if(e==3||e==4)n+=d.$.offsetHeight-1;j.setStyles({left:m+'px',top:n+'px',display:''});if(i.autoSize){function o(){j.getFirst().setStyle('height',i.element.$.scrollHeight+'px');};if(!CKEDITOR.env.gecko||h.isLoaded)o();else h.onLoad=o;}else j.getFirst().removeStyle('height');if(!this._.blurSet){var p=CKEDITOR.env.ie?k:new CKEDITOR.dom.window(k.$.contentWindow);p.on('blur',function(){if(!this._.activeChild)this.hide();},this);p.on('focus',function(){this._.focused=true;this.hideChild();},this);this._.blurSet=1;}setTimeout(function(){k.$.contentWindow.focus();},0);h.onEscape=CKEDITOR.tools.bind(function(){this.onEscape&&this.onEscape();},this);if(this.onShow)this.onShow.call(this);},hide:function(){var c=this;if(!c.onHide||c.onHide.call(c)!==true){c.hideChild();c.element.setStyle('display','none');}},showAsChild:function(c,d,e,f,g,h){this.hideChild();c.onHide=CKEDITOR.tools.bind(function(){CKEDITOR.tools.setTimeout(function(){if(!this._.focused)this.hide();},0,this);},this);this._.activeChild=c;this._.focused=false;c.showBlock(d,e,f,g,h);},hideChild:function(){var c=this._.activeChild;if(c){delete c.onHide;delete this._.activeChild;c.hide();}}}});})();
