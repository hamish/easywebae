/*
Copyright (c) 2003-2009, CKSource - Frederico Knabben. All rights reserved.
For licensing, see LICENSE.html or http://ckeditor.com/license
*/

(function(){CKEDITOR.plugins.add('stylescombo',{requires:['richcombo','styles'],init:function(d){var e=d.config,f=d.lang.stylesCombo,g=this.path,h,i;d.ui.addRichCombo('Styles',{label:f.label,title:f.panelTitle,className:'cke_styles',multiSelect:true,panel:{css:[e.contentsCss,d.skinPath+'editor.css']},init:function(){var j=this,k=e.stylesCombo_stylesSet.split(':',2),l=k[1]||CKEDITOR.getUrl(g+'styles/'+k[0]+'.js');k=k[0];CKEDITOR.loadStylesSet(k,l,function(m){var n,o,p=[];h={};for(var q=0;q<m.length;q++){var r=m[q];o=r.name;n=h[o]=new CKEDITOR.style(r);n._name=o;p.push(n);}p.sort(c);var s;for(var q=0;q<p.length;q++){n=p[q];o=n._name;var t=n.type;if(t!=s){j.startGroup(f['panelTitle'+String(t)]);s=t;}j.add(o,n.type==CKEDITOR.STYLE_OBJECT?o:b(n._.definition),o);}j.commit();j.onOpen();});},onClick:function(j){d.focus();var k=h[j],l=d.getSelection();if(i){l.selectRanges(i);i=false;}if(k.type==CKEDITOR.STYLE_OBJECT){var m=l.getSelectedElement();if(m)k.applyToObject(m);return;}var n=new CKEDITOR.dom.elementPath(l.getStartElement());if(k.type==CKEDITOR.STYLE_INLINE&&k.checkActive(n))k.remove(d.document);else k.apply(d.document);},onRender:function(){d.on('selectionChange',function(j){var k=this.getValue(),l=j.data.path;elements=l.elements;for(var m=0,n;m<elements.length;m++){n=elements[m];for(var o in h)if(h[o].checkElementRemovable(n,true)){if(o!=k)this.setValue(o);return;}}this.setValue('');},this);},onOpen:function(){var r=this;d.focus();var j=d.getSelection();if(CKEDITOR.env.ie&&j)i=j.getRanges();var k,l=j.getSelectedElement(),m=l&&l.getName(),n=m&&!CKEDITOR.dtd.$block[m]&&!CKEDITOR.dtd.$listItem[m]&&!CKEDITOR.dtd.$tableContent[m],o=[0,0,0,0];if(!l||n)k=new CKEDITOR.dom.elementPath(j.getStartElement());r.showAll();r.unmarkAll();for(var p in h){var q=h[p];type=q.type;if(type==CKEDITOR.STYLE_OBJECT)if(l&&q.element==m){if(q.checkElementRemovable(l,true))r.mark(p);o[type]++;}else r.hideItem(p);else if(k){if(q.checkActive(k))r.mark(p);o[type]++;}else r.hideItem(p);}if(!o[CKEDITOR.STYLE_BLOCK])r.hideGroup(f['panelTitle'+String(CKEDITOR.STYLE_BLOCK)]);if(!o[CKEDITOR.STYLE_INLINE])r.hideGroup(f['panelTitle'+String(CKEDITOR.STYLE_INLINE)]);if(!o[CKEDITOR.STYLE_OBJECT])r.hideGroup(f['panelTitle'+String(CKEDITOR.STYLE_OBJECT)]);},onClose:function(){i=null;}});}});var a={};CKEDITOR.addStylesSet=function(d,e){a[d]=e;};CKEDITOR.loadStylesSet=function(d,e,f){var g=a[d];if(g)return f(a);CKEDITOR.scriptLoader.load(e,function(){f(a[d]);});};function b(d){var e=[],f=d.element;if(f=='bdo')f='span';
e=['<',f];var g=d.attributes;if(g)for(var h in g)e.push(' ',h,'="',g[h],'"');var i=CKEDITOR.style.getStyleText(d);if(i)e.push(' style="',i,'"');e.push('>',d.name,'</',f,'>');return e.join('');};function c(d,e){var f=d.type,g=e.type;return f==g?0:f==CKEDITOR.STYLE_OBJECT?-1:g==CKEDITOR.STYLE_OBJECT?1:g==CKEDITOR.STYLE_BLOCK?1:-1;};})();CKEDITOR.config.stylesCombo_stylesSet='default';
